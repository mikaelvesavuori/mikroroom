<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f0f0f">
    <title>MikroRoom - Ultralight Video Meetings</title>
    <link rel="stylesheet" href="/style.css">
    <!-- SVG Icon Sprite -->
    <svg style="display: none;">
      <defs>
        <!-- Microphone -->
        <symbol id="icon-mic" viewBox="0 0 24 24" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z" />
        </symbol>
        <!-- Microphone Off -->
        <symbol id="icon-mic-off" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 3L21 21" />
        </symbol>
        <!-- Video Camera -->
        <symbol id="icon-video" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z" />
        </symbol>
        <!-- Video Camera Off -->
        <symbol id="icon-video-off" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M12 18.75H4.5a2.25 2.25 0 0 1-2.25-2.25V9m12.841 9.091L16.5 19.5m-1.409-1.409c.407-.407.659-.97.659-1.591v-9a2.25 2.25 0 0 0-2.25-2.25h-9c-.621 0-1.184.252-1.591.659m12.182 12.182L2.909 5.909M1.5 4.5l1.409 1.409" />
        </symbol>
        <!-- Hand/Palm -->
        <symbol id="icon-hand" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M10.05 4.575a1.575 1.575 0 1 0-3.15 0v3m3.15-3v-1.5a1.575 1.575 0 0 1 3.15 0v1.5m-3.15 0 .075 5.925m3.075.75V4.575m0 0a1.575 1.575 0 0 1 3.15 0V15M6.9 7.575a1.575 1.575 0 1 0-3.15 0v8.175a6.75 6.75 0 0 0 6.75 6.75h2.018a5.25 5.25 0 0 0 3.712-1.538l1.732-1.732a5.25 5.25 0 0 0 1.538-3.712l.003-2.024a.668.668 0 0 1 .198-.471 1.575 1.575 0 1 0-2.228-2.228 3.818 3.818 0 0 0-1.12 2.687M6.9 7.575V12m6.27 4.318A4.49 4.49 0 0 1 16.35 15m.002 0h-.002" />
        </symbol>
        <!-- Screen Share -->
        <symbol id="icon-screen" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M9 17.25v1.007a3 3 0 0 1-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0 1 15 18.257V17.25m6-12V15a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 15V5.25m18 0A2.25 2.25 0 0 0 18.75 3H5.25A2.25 2.25 0 0 0 3 5.25m18 0V12a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 12V5.25" />
        </symbol>
        <!-- Chat -->
        <symbol id="icon-chat" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z" />
        </symbol>
        <!-- People/Group -->
        <symbol id="icon-people" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
        </symbol>
        <!-- Record Circle -->
        <symbol id="icon-record" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="8" />
        </symbol>
        <!-- Stop Square -->
        <symbol id="icon-stop" viewBox="0 0 24 24">
          <rect x="6" y="6" width="12" height="12" rx="2" />
        </symbol>
        <!-- Lock -->
        <symbol id="icon-lock" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
        </symbol>
        <!-- Lock Open -->
        <symbol id="icon-lock-open" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M13.5 10.5V6.75a4.5 4.5 0 1 1 9 0v3.75M3.75 21.75h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H3.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
        </symbol>
        <!-- Make Moderator -->
        <symbol id="make-moderator" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="m15 11.25-3-3m0 0-3 3m3-3v7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
        </symbol>
        <!-- Phone/Leave -->
        <symbol id="icon-phone" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z" />
        </symbol>
        <!-- Close X -->
        <symbol id="icon-close" viewBox="0 0 24 24">
          <path
            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
        </symbol>
        <!-- Send Arrow -->
        <symbol id="icon-send" viewBox="0 0 24 24">
          <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
        </symbol>
        <!-- Paperclip/Attachment -->
        <symbol id="icon-attach" viewBox="0 0 24 24">
          <path
            d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z" />
        </symbol>
        <!-- Recording Dot -->
        <symbol id="icon-rec-dot" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="6" />
        </symbol>
        <!-- More/Menu (three dots) -->
        <symbol id="icon-more" viewBox="0 0 24 24">
          <circle cx="12" cy="6" r="2" />
          <circle cx="12" cy="12" r="2" />
          <circle cx="12" cy="18" r="2" />
        </symbol>
        <!-- Link/Copy -->
        <symbol id="icon-link" viewBox="0 0 24 24">
          <path
            d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z" />
        </symbol>
        <!-- Checkmark -->
        <symbol id="icon-check" viewBox="0 0 24 24">
          <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
        </symbol>
      </defs>
    </svg>
  </head>

  <body>
    <div id="app">
      <!-- Landing Screen -->
      <div id="landing" class="screen">
        <div class="container">
          <h1>MikroRoom</h1>
          <p class="subtitle">Ultralight video meetings</p>

          <!-- Initial view: Create or Join -->
          <div id="landing-initial" class="landing-view">
            <div class="name-input-group">
              <input type="text" id="name" placeholder="Your name" required minlength="1" maxlength="30"
                autocomplete="name">
            </div>

            <div class="action-buttons">
              <button type="button" id="btn-create-meeting" class="btn btn-primary btn-large">
                <span>New Meeting</span>
              </button>
              <button type="button" id="btn-show-join" class="btn btn-secondary btn-large">
                <span>Join with code</span>
              </button>
            </div>

            <button type="button" id="btn-show-advanced" class="btn-link">Advanced options</button>
          </div>

          <!-- Join with code view -->
          <div id="landing-join" class="landing-view hidden">
            <form id="join-form" class="join-form-simple">
              <div class="form-group-inline">
                <input type="text" id="room" placeholder="Enter 6-character code" maxlength="6" minlength="6"
                  pattern="[A-Za-z0-9]{6}" required autofocus>
                <button type="submit" class="btn btn-primary">Join</button>
              </div>
              <div class="form-group-compact" style="margin-top: 0.75rem;">
                <input type="password" id="join-password" placeholder="Password (if required)" maxlength="50"
                  autocomplete="current-password">
              </div>
            </form>
            <button type="button" id="btn-back-initial" class="btn-link">Back</button>
          </div>

          <!-- Advanced options (collapsible) -->
          <div id="landing-advanced" class="landing-advanced hidden">
            <div class="advanced-content">
              <div class="form-group-compact">
                <input type="password" id="room-password" placeholder="Password (optional)" maxlength="50"
                  autocomplete="new-password">
              </div>
              <div class="form-group-compact">
                <input type="number" id="max-participants" placeholder="Max participants (default: 8)" min="2" max="50">
              </div>
            </div>
          </div>

          <!-- Meeting created confirmation -->
          <div id="landing-created" class="landing-view hidden">
            <div class="meeting-created">
              <div class="created-icon">✓</div>
              <h3>Meeting ready</h3>
              <p>Share this link with anyone you want to join.</p>
              <div class="share-link-group">
                <input type="text" id="created-link" readonly>
                <button type="button" id="btn-copy-created-link" class="btn-icon-inline" title="Copy link">
                  <svg class="icon">
                    <use href="#icon-link" />
                  </svg>
                </button>
              </div>
              <button type="button" id="btn-join-created" class="btn btn-primary btn-large">Join now</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading Screen -->
      <div id="loading" class="screen hidden">
        <div class="spinner"></div>
        <p>Connecting to meeting...</p>
      </div>

      <!-- Waiting Screen -->
      <div id="waiting" class="screen hidden">
        <div class="container">
          <div class="spinner"></div>
          <p>Waiting for host to admit you...</p>
        </div>
      </div>

      <!-- Meeting Screen -->
      <div id="meeting" class="screen hidden">
        <!-- Header -->
        <div class="meeting-header">
          <div class="header-left">
            <div class="room-info">
              <span id="room-title" class="room-code"></span>
              <span class="participant-count"><span id="participant-count">1</span></span>
            </div>
            <div class="status-indicators">
              <span id="recording-indicator" class="status-badge recording hidden" title="Recording">
                <svg class="icon">
                  <use href="#icon-rec-dot" />
                </svg>
              </span>
              <span id="lock-indicator" class="status-badge locked hidden" title="Locked">
                <svg class="icon">
                  <use href="#icon-lock" />
                </svg>
              </span>
              <span id="connection-quality" class="connection-quality unknown hidden" title="Connection">●</span>
            </div>
          </div>
          <button id="btn-invite" class="btn-invite" title="Invite others">
            <svg class="icon">
              <use href="#icon-link" />
            </svg>
            <span class="desktop-only">Invite</span>
          </button>
        </div>

        <!-- Video Grid -->
        <div class="video-container">
          <!-- Video grid with local + remote participants -->
          <div id="video-grid" class="video-grid">
            <!-- Local video (always first child; CSS handles PiP when remotes present) -->
            <div id="local-video-container" class="video-item local">
              <video id="local-video" autoplay muted playsinline></video>
              <div class="video-label">
                <div class="status-icons">
                  <span class="muted-indicator" id="local-muted" title="Muted">
                    <svg class="icon">
                      <use href="#icon-mic-off" />
                    </svg>
                  </span>
                  <span class="video-off-indicator" id="local-video-off" title="Camera Off">
                    <svg class="icon">
                      <use href="#icon-video-off" />
                    </svg>
                  </span>
                  <span class="hand-indicator" id="local-hand" title="Hand Raised">
                    <svg class="icon">
                      <use href="#icon-hand" />
                    </svg>
                  </span>
                </div>
              </div>
            </div>
            <!-- Remote videos will be added here by JS -->
          </div>

          <!-- Pagination controls -->
          <button id="video-nav-prev" class="video-nav-btn video-nav-prev hidden" aria-label="Previous">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
            </svg>
          </button>
          <button id="video-nav-next" class="video-nav-btn video-nav-next hidden" aria-label="Next">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
            </svg>
          </button>
          <div id="video-pagination" class="video-pagination hidden">
            <span id="video-page-indicator">1 / 1</span>
          </div>

          <!-- Chat Panel -->
          <div id="chat-panel" class="chat-panel hidden">
            <div class="chat-header">
              <h3>Chat</h3>
              <button id="btn-close-chat" class="btn-icon" title="Close">
                <svg class="icon">
                  <use href="#icon-close" />
                </svg>
              </button>
            </div>
            <div id="chat-messages" class="chat-messages"></div>
            <div class="chat-input-container">
              <input type="text" id="chat-input" placeholder="Type a message..." maxlength="500">
              <button id="btn-send-chat" class="btn-icon" title="Send">
                <svg class="icon">
                  <use href="#icon-send" />
                </svg>
              </button>
            </div>
          </div>

          <!-- Participants Panel -->
          <div id="participants-panel" class="participants-panel hidden">
            <div class="participants-header">
              <h3>Participants</h3>
              <button id="btn-close-participants" class="btn-icon" title="Close">
                <svg class="icon">
                  <use href="#icon-close" />
                </svg>
              </button>
            </div>
            <div id="participants-list" class="participants-list"></div>

            <!-- Waiting Room Section (for moderators) -->
            <div id="waiting-room-section" class="waiting-room-section hidden">
              <h4>Waiting Room</h4>
              <div id="waiting-room-list" class="waiting-room-list"></div>
              <button id="btn-admit-all" class="btn btn-secondary hidden">Admit All</button>
            </div>
          </div>

          <!-- File Transfer Panel -->
          <div id="file-transfer-panel" class="file-transfer-panel hidden">
            <h4>File Transfers</h4>
            <div id="file-transfer-list" class="file-transfer-list"></div>
          </div>

          <!-- Mobile Menu Panel -->
          <div id="mobile-menu" class="mobile-menu hidden">
            <div class="mobile-menu-handle"></div>
            <div class="mobile-menu-content">
              <button id="btn-mobile-chat" class="mobile-menu-item">
                <svg class="icon">
                  <use href="#icon-chat" />
                </svg>
                <span>Chat</span>
                <span id="chat-unread-mobile" class="unread-dot hidden"></span>
              </button>
              <button id="btn-mobile-participants" class="mobile-menu-item">
                <svg class="icon">
                  <use href="#icon-people" />
                </svg>
                <span>Participants</span>
              </button>
              <button id="btn-mobile-screen" class="mobile-menu-item">
                <svg class="icon">
                  <use href="#icon-screen" />
                </svg>
                <span>Share screen</span>
              </button>
              <button id="btn-mobile-hand" class="mobile-menu-item">
                <svg class="icon">
                  <use href="#icon-hand" />
                </svg>
                <span>Raise hand</span>
              </button>
              <button id="btn-mobile-record" class="mobile-menu-item hidden">
                <svg class="icon">
                  <use href="#icon-record" />
                </svg>
                <span>Record</span>
              </button>
              <button id="btn-mobile-lock" class="mobile-menu-item hidden">
                <svg class="icon">
                  <use href="#icon-lock" />
                </svg>
                <span>Lock</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Controls -->
        <div class="controls">
          <div class="control-group main">
            <button id="btn-mute" class="control-btn" title="Microphone">
              <svg class="icon" id="icon-mute">
                <use href="#icon-mic" />
              </svg>
              <svg class="icon" id="icon-unmute" style="display: none;">
                <use href="#icon-mic-off" />
              </svg>
            </button>
            <button id="btn-video" class="control-btn" title="Camera">
              <svg class="icon" id="icon-video-on">
                <use href="#icon-video" />
              </svg>
              <svg class="icon" id="icon-video-off" style="display: none;">
                <use href="#icon-video-off" />
              </svg>
            </button>
            <button id="btn-screen" class="control-btn desktop-only" title="Share screen">
              <svg class="icon">
                <use href="#icon-screen" />
              </svg>
            </button>
            <button id="btn-chat" class="control-btn desktop-only" title="Chat">
              <svg class="icon">
                <use href="#icon-chat" />
              </svg>
              <span id="chat-unread" class="unread-dot hidden"></span>
            </button>
            <button id="btn-participants" class="control-btn desktop-only" title="Participants">
              <svg class="icon">
                <use href="#icon-people" />
              </svg>
            </button>
          </div>

          <button id="btn-more" class="control-btn mobile-only" title="More">
            <svg class="icon">
              <use href="#icon-more" />
            </svg>
          </button>

          <div class="control-group advanced desktop-only">
            <button id="btn-hand" class="control-btn" title="Raise hand">
              <svg class="icon">
                <use href="#icon-hand" />
              </svg>
            </button>
            <button id="btn-record" class="control-btn hidden" title="Record">
              <svg class="icon" id="icon-record-on">
                <use href="#icon-record" />
              </svg>
              <svg class="icon" id="icon-record-off" style="display: none;">
                <use href="#icon-stop" />
              </svg>
            </button>
            <button id="btn-lock" class="control-btn hidden" title="Lock room">
              <svg class="icon" id="icon-lock-closed">
                <use href="#icon-lock" />
              </svg>
              <svg class="icon" id="icon-lock-open" style="display: none;">
                <use href="#icon-lock-open" />
              </svg>
            </button>
          </div>

          <button id="btn-leave" class="control-btn danger" title="Leave">
            <svg class="icon">
              <use href="#icon-phone" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Error Screen -->
      <div id="error" class="screen hidden">
        <div class="container">
          <h1>Error</h1>
          <p id="error-message">Something went wrong</p>
          <button id="btn-retry" class="btn btn-primary">Try Again</button>
        </div>
      </div>
    </div>

    <script src="/app.js"></script>
  </body>

</html>